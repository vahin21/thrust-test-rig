<!DOCTYPE html>
<html>
<head>
  <title>Thrust Test Rig</title>
</head>
<body>

<h2>Thrust Test Rig Dashboard</h2>

<h3>Login</h3>
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>

<br><br>

<input type="number" id="otp" placeholder="Enter OTP">
<button onclick="verify()">Verify</button>

<hr>

<h3>Live Thrust</h3>
<p id="thrust">0</p>

<h3>Calibration</h3>
<input type="number" id="knownWeight" placeholder="Known weight (g)">
<button onclick="calibrate()">Calibrate</button>
<button onclick="tare()">Tare</button>

<p>Calibration Factor: <span id="calValue">-</span></p>

<hr>

<button id="fireBtn" disabled onclick="fire()">FIRE MOTOR</button>

<script>

let verified = false;

async function login() {
  await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password: document.getElementById("password").value })
  });
}

async function verify() {
  const res = await fetch("/api/verify", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ otp: document.getElementById("otp").value })
  });

  if (res.ok) {
    verified = true;
    alert("Access Granted");
  }
}

async function calibrate() {
  if (!verified) return alert("Not verified");

  await fetch("/api/calibrate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ weight: document.getElementById("knownWeight").value })
  });
}

async function tare() {
  if (!verified) return alert("Not verified");

  await fetch("/api/tare");
}

async function fire() {
  if (!verified) return alert("Not verified");
  await fetch("/api/fire");
}

setInterval(async () => {

  const res = await fetch("/api/data");
  const json = await res.json();

  document.getElementById("thrust").innerText = json.thrust;
  document.getElementById("calValue").innerText = json.calibration;

  if (verified && json.thrust !== undefined) {
    document.getElementById("fireBtn").disabled = false;
  }

}, 1000);

</script>

</body>
</html>
